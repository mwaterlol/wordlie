// @ts-expect-error
import type {PluginOption, ViteDevServer} from 'vite';

export default function i18next(): PluginOption {
  return [
    {
      name: 'vite-plugin-i18next',
      configureServer(server: ViteDevServer) {
        return () => {
          server.middlewares.use((req, res, next) => {
            if (req.originalUrl?.startsWith('/_i18next')) {
              res.setHeader('Content-Type', 'text/html');
              res.writeHead(200);
              res.write(
                `<!DOCTYPE html>
             <html lang="zh-CN">
             <head>
               <meta charset="UTF-8" />
               <meta name="viewport" content="width=device-width, initial-scale=1.0" />
               <title>i18next wip</title>
             </head>
             <body>
             ${req.originalUrl}
             </body>

             </html>
             `,
              );
              res.end();
            }

            next();
          });
        };
      },
    },
  ];
}
